<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Queue Status - RSU REQS</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    />
    <link href="/assets/css/style.css" rel="stylesheet" />

    <style>
      .register-card-custom {
        max-width: 1000px;
        width: 100%;
      }
    </style>
  </head>

  <body>
    <!-- Guest Dashboard Section -->
    <div class="d-flex flex-grow-1 justify-content-center align-items-center">
      <div class="register-card-custom">
        <div
          class="logo d-flex flex-column justify-content-center align-items-center"
        >
          <div
            class="d-flex flex-row justify-content-center align-items-center mb-2"
          >
            <img
              src="/assets/img/rsu_logo.png"
              alt="RSU Logo"
              width="55"
              height="55"
              class="me-2"
            />
            <img
              src="/assets/img/registrar_logo.png"
              alt="Registrar Logo"
              width="40"
              height="40"
              class="me-2"
            />
          </div>
          <a href="/">
            <div class="d-flex flex-column lh-sm">
              <p class="fw-bold">Registrar's Office</p>
              <p class="fw-bold">Romblon State University - Odiongan</p>
            </div>
          </a>
        </div>
        <div class="content">
          <div class="queue-header text-center p-4 bg-light border rounded">
            <h2 class="mb-1 fw-bold">QUEUE STATUS</h2>
            <h5 class="text-primary fw-bold d-block" id="live-time">
              09:27:04
            </h5>
            <h5 class="text-muted d-block" id="live-date">
              Thursday, October 30, 2025
            </h5>
          </div>
          <!-- <h1>QUEUE STATUS</h1> -->

          <div class="row g-4">
            <!-- Now Serving -->
            <div class="col-md-8">
              <div class="now-serving text-center">
                <h2>NOW SERVING</h2>
                <hr />
                <div class="queue-number">Loading...</div>
                <small class="text-muted">Queue Number:</small>
              </div>
            </div>

            <!-- Coming Up Next -->
            <div class="col-md-4">
              <div class="coming-next text-center">
                <h3>COMING UP NEXT</h3>
                <ul>
                  <!-- Dynamic items will be added here -->
                </ul>
              </div>
            </div>

            <!-- Ready to Claim -->
            <div class="ready-claim mt-4">
              <h3>READY TO CLAIM â†“</h3>
              <div class="codes">
                <!-- Dynamic items will be added here -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- <footer class="py-3 border-top text-center mt-2"></footer> -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
<script>
  // Consolidated live clock (updates time/date every second)
  function updateClock() {
    const now = new Date();
    // For testing with fixed date: Uncomment below and comment out the real date/time lines.
    // const now = new Date('2025-10-30T09:27:04'); // Fixed to October 30, 2025, 09:27:04

    const time = now.toLocaleTimeString("en-US", {
      hour12: false,
      hour: "2-digit",
      minute: "2-digit",
      second: "2-digit",
    });
    const date = now.toLocaleDateString("en-US", {
      weekday: "long",
      year: "numeric",
      month: "long",
      day: "numeric",
    });

    document.getElementById("live-time").textContent = time;
    document.getElementById("live-date").textContent = date;
  }

  // Update clock immediately and every second
  updateClock();
  setInterval(updateClock, 1000);

  // New: Function to fetch and update queue status from API
  async function updateQueueStatus() {
    try {
      const response = await fetch("/api/queue/status");
      if (!response.ok) {
        throw new Error("API error");
      }
      const data = await response.json();

      if (data.success) {
        // Update NOW SERVING
        const nowServingElem = document.querySelector(
          ".now-serving .queue-number"
        );
        nowServingElem.textContent = data.nowServing || "None";

        // Update COMING UP NEXT (clear and rebuild list)
        const comingNextList = document.querySelector(".coming-next ul");
        comingNextList.innerHTML = ""; // Clear static items
        data.comingNext.forEach((item, index) => {
          const li = document.createElement("li");
          li.textContent = item;
          if (index === 0) li.innerHTML = `<strong>${item}</strong>`; // Bold first item as in your static example
          comingNextList.appendChild(li);
        });
        if (data.comingNext.length === 0) {
          const li = document.createElement("li");
          li.textContent = "None";
          comingNextList.appendChild(li);
        }

        // Update READY TO CLAIM (clear and rebuild grid)
        const readyClaimCodes = document.querySelector(".ready-claim .codes");
        readyClaimCodes.innerHTML = ""; // Clear static items
        data.readyToClaim.forEach((item) => {
          const div = document.createElement("div");
          div.textContent = item;
          readyClaimCodes.appendChild(div);
        });
        if (data.readyToClaim.length === 0) {
          const div = document.createElement("div");
          div.textContent = "None";
          readyClaimCodes.appendChild(div);
        }
      }
    } catch (error) {
      console.error("Error fetching queue status:", error);
      // Fallback: Show "Loading..." if error (prevents blank page)
      document.querySelector(".now-serving .queue-number").textContent =
        "Loading...";
      document.querySelector(".coming-next ul").innerHTML =
        "<li>Loading...</li>";
      document.querySelector(".ready-claim .codes").innerHTML =
        "<div>Loading...</div>";
    }
  }

  // Load queue status immediately and refresh every 5 seconds for sync
  updateQueueStatus();
  setInterval(updateQueueStatus, 5000);
</script>
